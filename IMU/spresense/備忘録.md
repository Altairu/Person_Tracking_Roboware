# ðŸš€ IMU_experiment â€“ Spresense 

ã“ã®ãƒªãƒã‚¸ãƒˆãƒªã¯ã€Sony Spresense SDK ã¨é€£æº
## ðŸ“¦ å¿…è¦ç’°å¢ƒ

* Ubuntu 22.04 ä»¥ä¸Š
* Sony Spresense SDKï¼ˆå…¬å¼ï¼‰
* arm-none-eabi-gcc ãƒ„ãƒ¼ãƒ«ãƒã‚§ãƒ¼ãƒ³
* Spresense ãƒœãƒ¼ãƒ‰
* USB ã‚±ãƒ¼ãƒ–ãƒ«

### 1. ã‚³ãƒ¼ãƒ‰ã‚’ä¸Šæ›¸ãä¿å­˜

ä»¥ä¸‹ä¾‹
```bash
cp /home/altair/IMU_experiment/spresense/simple_pospredict_pwbimu_main.c /home/altair/spresense/examples/pospredict_pwbimu/simple_pospredict_pwbimu_main.c
```

### 2. ã‚³ãƒ³ãƒ•ã‚£ã‚°è¨­å®šã¨ãƒ“ãƒ«ãƒ‰

Spresense SDK ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ãƒ“ãƒ«ãƒ‰æ“ä½œã‚’è¡Œã„ã¾ã™ã€‚

```bash
cd ~/spresense/sdk
source tools/build-env.sh
make distclean

# ã‚³ãƒ³ãƒ•ã‚£ã‚°é©ç”¨
tools/config.py examples/pospredict_pwbimu

# ãƒ“ãƒ«ãƒ‰ï¼ˆmenuconfigã§ç¢ºèªã—ã¦ã‚‚OKï¼‰
make -j
```

### 3. æ›¸ãè¾¼ã¿

```bash
tools/flash.sh -c /dev/ttyUSB0 nuttx.spk
```

```bash
screen /dev/ttyUSB0 115200
```

ã¾ã¨ã‚ãŸã‚„ã¤
```bash
cp /home/altair/IMU_experiment/spresense/simple_pospredict_pwbimu_main.c /home/altair/spresense/examples/pospredict_pwbimu/simple_pospredict_pwbimu_main.c && cd ~/spresense/sdk && source tools/build-env.sh && make distclean && tools/config.py examples/pospredict_pwbimu && make -j && tools/flash.sh -c /dev/ttyUSB0 nuttx.spk
```

## ðŸ§© å‚è€ƒæƒ…å ±

* Sony å…¬å¼ SDK ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
  [https://developer.sony.com/develop/spresense/docs/sdk_developer_guide_ja.html](https://developer.sony.com/develop/spresense/docs/sdk_developer_guide_ja.html)
* SDK GitHub
  [https://github.com/sonydevworld/spresense](https://github.com/sonydevworld/spresense)

## ðŸ“ ãã®ä»–

* IMUãƒŽã‚¤ã‚ºãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨ˆç®—ç”¨ã‚³ãƒ¼ãƒ‰ çµæžœ
```bash
NuttShell (NSH) NuttX-12.3.0
nsh> help
help usage:  help [-v] [<cmd>]

    .            cmp          false        mkdir        ps           true
    [            dirname      fdinfo       mkfatfs      pwd          truncate
    ?            date         free         mkfifo       reboot       uname
    alias        dd           help         mkrd         rm           umount
    unalias      df           hexdump      mksmartfs    rmdir        unset
    basename     dmesg        ifconfig     mount        set          uptime
    break        echo         ifdown       mv           sleep        usleep
    cat          env          ifup         pidof        source       xd
    cd           exec         kill         poweroff     test
    cp           exit         ls           printf       time

Builtin Apps:
    nsh           pospredict    sh
nsh> pospredict
======================================
 IMU Noise Parameter Calculator
======================================
Place the sensor on a flat, stable surface.
Measurement starts in 3 seconds...
 3...
 2...
 1...
 START! (Do not move for 20 sec)
....................
Done.

--- Measured Variances (Raw) ---
Acc X: 0.003537, Y: 0.000384, Z: 0.000452 (Avg: 0.001458)
Gyro X: 0.000000, Y: 0.000002, Z: 0.000001 (Avg: 0.000001)

--- Recommended Parameters for Your Code ---
// Paste these lines into your code:

#define VAR_ACC_NOISE       (0.001458f)
#define VAR_BIAS_NOISE      (0.00000001f) /* Approx. GyroVar/100 */
#define VAR_POS_MEAS        (0.1f)     /* Keep manual */
#define VAR_VEL_MEAS        (5.0f)     /* Keep manual */
``` 

```bash
nsh> pospredict
======================================
 IMU Noise Parameter Calculator
======================================
Place the sensor on a flat, stable surface.
Measurement starts in 3 seconds...
 3...
 2...
 1...
 START! (Do not move for 100 sec)
....................................................................................................
Done.

--- Measured Variances (Raw) ---
Acc X: 0.004076, Y: 0.000366, Z: 0.000459 (Avg: 0.001634)
Gyro X: 0.000000, Y: 0.000002, Z: 0.000001 (Avg: 0.000001)

--- Recommended Parameters for Your Code ---
// Paste these lines into your code:

#define VAR_ACC_NOISE       (0.001634f)
#define VAR_BIAS_NOISE      (0.00000001f) /* Approx. GyroVar/100 */
#define VAR_POS_MEAS        (0.1f)     /* Keep manual */
#define VAR_VEL_MEAS        (5.0f)     /* Keep manual */
```

```c
/* KFãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚° */
#define VAR_ACC_NOISE (0.1f) /* åŠ é€Ÿåº¦ã‚»ãƒ³ã‚µã®ãƒŽã‚¤ã‚ºåˆ†æ•£ */
#define VAR_BIAS_NOISE                                                         \
  (0.001f)                  /* ãƒã‚¤ã‚¢ã‚¹å¤‰å‹•ã®åˆ†æ•£ï¼ˆãƒã‚¤ã‚¢ã‚¹ã¯ã‚†ã£ãã‚Šå¤‰ã‚ã‚‹ï¼‰ */
#define VAR_POS_MEAS (0.1f) /* ä½ç½®è¦³æ¸¬ãƒŽã‚¤ã‚ºï¼ˆPCã‚’ä¿¡é ¼ï¼‰ */
#define VAR_VEL_MEAS                                                           \
  (5.0f) /* é€Ÿåº¦è¦³æ¸¬ãƒŽã‚¤ã‚ºï¼ˆIMUã®æ»‘ã‚‰ã‹ã•å„ªå…ˆã®ãŸã‚ç·©ã‚ã‚‹ï¼‰ */

```

```c
/* KFãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚° */
#define VAR_ACC_NOISE (0.001634f)
#define VAR_BIAS_NOISE (0.00000001f) /* Approx. GyroVar/100 */
#define VAR_POS_MEAS (0.00000001f)   /* Keep manual */
#define VAR_VEL_MEAS (0.001f)        /* Keep manual */
```

å‡¦ç†é€Ÿåº¦å®Ÿé¨“
```bash
nsh> pospredict
==========================================
   IMU Algorithm Speed Benchmark Tool
==========================================
[Step 1] Capturing real IMU data (5000 samples)...
Data capture complete. Starting benchmark...

===== Benchmark Results (samples: 5000) =====
1. Normal Estimation:
   Total Time: 16265 us
   Avg per cycle: 3.253 us

2. Augmented Kalman Filter:
   Total Time: 29540 us
   Avg per cycle: 5.908 us

3. Drift Learning (Normal + Bias Feedback):
   Total Time: 16235 us
   Avg per cycle: 3.247 us
   (Note: Drift Learning prediction cost is identical to Normal)
==========================================
```